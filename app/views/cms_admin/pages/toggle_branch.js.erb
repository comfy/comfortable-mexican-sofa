var li = $('li#cms_page_<%=@page.id%>');
li.find('.item').first().toggleClass('open');
<% if session[:cms_page_tree].member?(@page.id.to_s) %>
  if(!li.find('ul.children')[0]) {
    <% if ComfortableMexicanSofa.config.variations.present? %>
      li.append('<ul class="children sortable"><%= escape_javascript(render :partial => "variation_index_branch", :collection => @page.children) %></ul>');
    <% else %>
      li.append('<ul class="children sortable"><%= escape_javascript(render :partial => "index_branch", :collection => @page.children) %></ul>');
    <% end %>
    CMS.sortable_list();
  }
<% else %>
  li.find('ul.children').remove();
<% end %>